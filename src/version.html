<!DOCTYPE html>
<html>
  <head>
    <title>Electron Updater Example</title>
  </head>
  <body>
    <div class="wrapper">
      <span>Current version: <span id="version">vX.Y.Z</span></span>

      <br />
      <div id="velocidade">NaN</div>
      <progress id="pct" max="100" value="90"></progress>
      <span id="atual">NaN</span>

      <div id="messages"></div>
    </div>

    <script>
      // Display the current version
      const version = window.location.hash.substring(1);
      document.getElementById("version").innerText = version;

      // Listen for messages
      const { ipcRenderer } = require("electron");

      ipcRenderer.on("message", function (ev, text) {
        const parsed = JSON.parse(text);
        if (parsed.type === "message") onMessage(parsed.data);
        if (parsed.type === "progress") onProgress(parsed.data);
      });

      function onMessage(msg) {
        const container = document.getElementById("messages");
        const message = document.createElement("div");
        message.innerHTML = msg;
        container.appendChild(message);
      }

      function onProgress(progressRaw) {
        const { bps, pct, curr, total } = progressRaw;
        // Ajusta velocidade
        document.getElementById("velocidade").innerHTML = exibeVelocidade(bps);
        document.getElementById("pct").value = pct;
        document.getElementById("atual").innerHTML = exibeAtualTotal(
          curr,
          total
        );
      }

      const KILO = 1024;

      const letras = ["", "k", "M", "G", "T"];

      function transformaEmNumero(num, fixo = -1) {
        let i = 0;

        if (fixo === -1) {
          while (num >= KILO) {
            num /= KILO;
            i++;
          }
        } else {
          i = fixo;
          for (let j = 0; j < i; j++) {
            num /= KILO;
          }
        }

        if (i <= 1) {
          num = num.toFixed(0);
        } else {
          num = num.toFixed(1);
        }

        return [num, letras[i], i];
      }

      function transformaEmByte(bytes, fixo = -1) {
        let obj = transformaEmNumero(bytes, fixo);
        obj[1] += "B";
        return obj;
      }

      function transformaEmBit(bytes, fixo = -1) {
        let obj = transformaEmNumero(bytes * 8, fixo);
        obj[1] += "b";
        return obj;
      }

      function exibeVelocidade(bytes) {
        const [num, letra, _] = transformaEmBit(bytes);
        return `${num} ${letra}/s`;
      }

      function exibeAtualTotal(atual, total) {
        const [numTotal, letra, i] = transformaEmByte(total);
        const numAtual = transformaEmByte(atual, i)[0];

        return `${numAtual} / ${numTotal} ${letra}`;
      }
    </script>
  </body>
</html>

<style>
  body {
    background-color: #227;
    color: #fff;
  }

  .wrapper {
    display: flex;
    flex-direction: column;
    width: 100%;
    align-items: center;
  }

  #messages {
    background-color: #000;
    width: 100%;
    min-height: 300px;
    margin: 1rem;
    border-radius: 0.5rem;
    padding: 1rem;
    box-sizing: border-box;
  }
</style>
